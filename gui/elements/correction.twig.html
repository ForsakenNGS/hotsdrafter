<div id="correct-hero-modal" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog text-dark" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Correct hero detection</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <select id="correct-hero-name" class="form-control">
                {% for heroName in draft.getHeroes().getNames() %}
                    <option value="{{ heroName }}">{{ heroName }}</option>
                {% endfor %}
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>
<script>
jQuery(function() {

    // Manually correct failed detections
    jQuery("[data-failed]").on("click", function () {
        let heroNameFailed = jQuery(this).attr("data-failed");
        if (heroNameFailed === "BAN") {
            let imageData = jQuery(this).attr("src");
            jQuery("#correct-hero-modal .btn-primary").off("click").on("click", function (e) {
                e.preventDefault();
                // Save correction
                app.screen.saveHeroBanImage(jQuery("#correct-hero-modal select").val(), imageData);
                // Hide modal
                jQuery("#correct-hero-modal").modal("hide");
                // Update app
                app.setModalActive(false);
                app.render();

            });
        } else {
            jQuery("#correct-hero-modal .btn-primary").off("click").on("click", function (e) {
                e.preventDefault();
                // Save correction
                app.screen.getHeroes().addCorrection(heroNameFailed, jQuery("#correct-hero-modal select").val());
                // Hide modal
                jQuery("#correct-hero-modal").modal("hide");
                // Update app
                app.setModalActive(false);
                app.render();
            });
        }
        jQuery("#correct-hero-modal").modal("show");
        jQuery("#correct-hero-modal").off("hidden.bs.modal").on("hidden.bs.modal", function () {
            // Update app
            app.setModalActive(false);
            app.render();
        });
        // Prevent re-rendering while the modal is open
        app.setModalActive(true);
    });

});
</script>
